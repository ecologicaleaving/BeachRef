# Story 1.1: Project Setup & Development Environment

## Status
Approved

## Story
**As a** developer,
**I want** a properly configured development environment with build tools and deployment pipeline,
**so that** I can develop and deploy BeachRef efficiently.

## Acceptance Criteria
1. Flutter Web project structure created with proper lib/ organization for frontend development
2. pubspec.yaml configuration with all required Flutter dependencies for development and production
3. Git repository initialized with appropriate .gitignore and README documentation
4. Flutter development scripts configured for web development, testing, and building
5. Basic CI/CD pipeline setup for automated testing and deployment
6. Environment configuration management for development, staging, and production

## Tasks / Subtasks
- [x] Task 1: Create Flutter Web project structure (AC: 1)
  - [x] Initialize Flutter project with web support
  - [x] Create lib/ directory structure following frontend architecture
  - [x] Set up app/, core/, data/, presentation/, and shared directories
  - [x] Create main.dart with basic app structure
- [x] Task 2: Configure pubspec.yaml with required dependencies (AC: 2)
  - [x] Add flutter_bloc 8.1.0+ for state management
  - [x] Add go_router 12.0.0+ for navigation
  - [x] Add supabase_flutter 2.0.0+ for backend integration
  - [x] Add connectivity_plus 5.0.0+ for network detection
  - [x] Add flutter_secure_storage 9.0.0+ for secure token storage
  - [x] Add mockito 5.4.0+ for testing
  - [x] Configure dev dependencies (flutter_test, flutter_lints 3.0.0+)
- [x] Task 3: Initialize Git repository with proper configuration (AC: 3)
  - [x] Create .gitignore file for Flutter/Dart projects
  - [x] Initialize git repository
  - [x] Create README.md with project description and setup instructions
  - [x] Set up initial commit
- [x] Task 4: Configure development scripts and tooling (AC: 4)
  - [x] Set up Flutter web development commands
  - [x] Configure testing commands
  - [x] Set up build commands for web deployment
  - [x] Configure linting and analysis
- [x] Task 5: Set up basic CI/CD pipeline (AC: 5)
  - [x] Create .github/workflows/deploy.yml for GitHub Actions
  - [x] Configure automated testing on pull requests
  - [x] Set up Vercel deployment integration
  - [x] Configure automated deployment on main branch
- [x] Task 6: Configure environment management (AC: 6)
  - [x] Create .env.example with required environment variables
  - [x] Set up development, staging, and production configurations
  - [x] Configure Supabase environment variables
  - [x] Set up Google OAuth environment variables
- [x] Task 7: Create unit tests for project structure (Testing requirement)
  - [x] Create test/unit/ directory structure
  - [x] Write basic tests for main.dart
  - [x] Set up test fixtures directory
  - [x] Configure test running scripts

## Dev Notes

### Previous Story Insights
No previous stories - this is the foundation story.

### Technology Stack Requirements
[Source: architecture/tech-stack.md]
- **Language**: Dart 3.2.0+ (Flutter's native language, cross-platform capability)
- **Framework**: Flutter 3.16.0+ (Cross-platform web/mobile, single codebase)
- **State Management**: flutter_bloc 8.1.0+ (Industry standard, testable, scalable)
- **Backend Integration**: supabase_flutter 2.0.0+ (Seamless auth, real-time subscriptions)
- **Network State**: connectivity_plus 5.0.0+ (Critical for offline-first approach)
- **Secure Storage**: flutter_secure_storage 9.0.0+ (Enhanced security for JWT tokens)
- **Routing**: go_router 12.0.0+ (Flutter team recommended, type-safe)
- **Web Hosting**: Vercel (Optimized for static sites, GitHub integration)
- **Development Tools**: Flutter SDK + VS Code (Official tooling, excellent debugging)

### Project Structure Requirements
[Source: architecture/source-tree.md and frontend-architecture.md]
Required directory structure:
```
beachref/
├── lib/
│   ├── main.dart                              # App entry + Supabase init
│   ├── app/
│   │   ├── app.dart                           # Material App setup
│   │   ├── router.dart                        # GoRouter with auth
│   │   └── theme.dart                         # Referee theme
│   ├── core/
│   │   ├── constants.dart                     # All constants in one place
│   │   ├── exceptions.dart                    # All custom exceptions
│   │   └── utils.dart                         # Shared utilities
│   ├── data/
│   │   ├── models/                            # Data models
│   │   ├── services/                          # Services layer
│   │   └── repositories/                      # Repository implementations
│   ├── presentation/
│   │   ├── blocs/                             # BLoC state management
│   │   ├── pages/                             # UI pages/screens
│   │   └── widgets/                           # Reusable UI components
│   └── shared/
│       ├── extensions.dart                    # Dart extensions
│       └── validators.dart                    # Form validation
├── test/
│   ├── unit/                                  # Service & repository tests
│   ├── widget/                                # Widget tests
│   └── fixtures/                              # Test data
├── integration_test/
│   └── app_test.dart                          # E2E critical flows
└── pubspec.yaml
```

### Environment Configuration Requirements
[Source: architecture/infrastructure-and-deployment.md]
- **Development**: Local Flutter + Supabase local development
- **Staging**: Vercel preview deployments + Supabase staging project
- **Production**: Vercel production + Supabase production project
- **CI/CD Platform**: GitHub Actions + Vercel integration
- **Pipeline Configuration**: `.github/workflows/deploy.yml`

### Coding Standards Requirements
[Source: architecture/coding-standards.md]
- **Languages & Runtimes**: Dart 3.2.0+, Flutter 3.16.0+
- **Style & Linting**: flutter_lints 3.0.0+ with custom rules
- **Test Organization**: `test/` mirrors `lib/` structure, `_test.dart` suffix
- **Critical Rules**:
  - Never use print() in production - Use logger service for all output
  - All API responses must use Result<T, Error> - Consistent error handling pattern
  - Database operations must use repository pattern - Never direct Supabase calls from UI
  - Background tasks must respect rate limits - All VIS calls through coordinated sync service
  - Sensitive data must never be logged - Strip PII and tokens from all log output

### Testing

#### Testing Standards
[Source: architecture/test-strategy-and-standards.md]
- **Framework**: test 1.24.0+ with mockito 5.4.0+ for mocking
- **File Convention**: `test/path/to/file_test.dart` mirrors `lib/path/to/file.dart`
- **Location**: `test/` directory with same structure as `lib/`
- **Mocking Library**: mockito for service mocking, fake objects for simple data
- **Coverage Requirement**: 90%+ for service and business logic classes
- **AI Agent Requirements**:
  - Generate tests for all public methods in services and use cases
  - Cover edge cases and error conditions with proper mocking
  - Follow AAA pattern (Arrange, Act, Assert) consistently
  - Mock all external dependencies (Supabase, VIS API, local storage)
- **Test Data Management**: Factory pattern with realistic test data, JSON fixtures in `test/fixtures/` directory
- **CI Integration**: Run unit/integration tests on every PR, E2E on staging deployment

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-26 | 1.0 | Initial story creation for project setup | Bob (SM) |
| 2025-07-26 | 1.1 | Story validated and approved for implementation | Sarah (PO) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
Claude Sonnet 4 (BMad Dev Agent James)

### Debug Log References
*To be populated by dev agent*

### Completion Notes List
- ✅ Successfully created Flutter web project with proper directory structure
- ✅ Configured all required dependencies including flutter_bloc, go_router, supabase_flutter
- ✅ Set up comprehensive testing framework with 19 passing tests
- ✅ Implemented Material 3 theming optimized for outdoor visibility 
- ✅ Created GitHub Actions CI/CD pipeline for automated testing and Vercel deployment
- ✅ Configured environment management with .env.example and Environment class
- ✅ Fixed email validation regex patterns for consistency across codebase
- ✅ All acceptance criteria met and validated through testing

### File List
**Created/Modified Files:**
- `lib/main.dart` - App entry point
- `lib/app/app.dart` - Main app configuration with Material 3 theming
- `lib/app/router.dart` - GoRouter configuration with home route
- `lib/app/theme.dart` - High-contrast theme for outdoor visibility
- `lib/core/constants.dart` - App constants and configuration values
- `lib/core/exceptions.dart` - Custom exception classes
- `lib/core/utils.dart` - Utility functions including email validation
- `lib/core/environment.dart` - Environment configuration management
- `lib/presentation/pages/home_page.dart` - Welcome page with volleyball branding
- `lib/shared/extensions.dart` - Dart extensions for common operations
- `lib/shared/validators.dart` - Form validation functions
- `pubspec.yaml` - Dependencies configuration with all required packages
- `.gitignore` - Comprehensive Flutter/Dart gitignore
- `README.md` - Project documentation with setup instructions
- `.github/workflows/deploy.yml` - CI/CD pipeline for testing and deployment
- `.env.example` - Environment variables template
- `test/widget_test.dart` - Widget test for main app functionality
- `test/unit/main_test.dart` - Unit test for app instantiation
- `test/unit/core/constants_test.dart` - Tests for app constants
- `test/unit/core/utils_test.dart` - Tests for utility functions
- `test/unit/shared/validators_test.dart` - Tests for validation functions
- `test/fixtures/test_data.dart` - Test data fixtures and constants

**Test Results:** 19/19 tests passing ✅

## QA Results
*Results from QA Agent review of the completed story implementation*