# Story 2.3: Tournament Detail View

## Status
Approved

## Story
**As a** user,
**I want** to view detailed information about a specific tournament,
**so that** I can understand the tournament structure and matches.

## Acceptance Criteria
1. Tournament detail page showing comprehensive tournament information
2. Match listings with basic information (teams, scores, dates)
3. Clean, organized presentation of tournament data
4. Navigation back to tournament list
5. Responsive design for mobile and desktop
6. Error handling for missing or incomplete data

## Tasks / Subtasks
- [ ] Backend API Enhancement (AC: 1, 2, 6)
  - [ ] Extend tournament.controller.ts with GET /api/tournaments/:id endpoint
  - [ ] Implement tournament.service.ts getTournamentById method with match data
  - [ ] Add match data aggregation from VIS API in vis.service.ts
  - [ ] Configure tournament detail data transformation including match listings
  - [ ] Implement caching strategy for tournament details (3-minute TTL)
  - [ ] Add comprehensive error handling for tournament not found scenarios
- [ ] Match Data Integration (AC: 2, 6)
  - [ ] Extend VIS service to fetch tournament matches from VIS API
  - [ ] Implement match data mapping from VIS API to Match interface
  - [ ] Add match status and score transformation logic
  - [ ] Configure match data caching and error resilience
  - [ ] Add team and player name formatting utilities
- [ ] Frontend Tournament Detail Component (AC: 1, 3, 5)
  - [ ] Create TournamentDetail.tsx component using shadcn/ui layout components
  - [ ] Implement tournament header section with name, dates, location, status
  - [ ] Add tournament metadata display (level, surface, gender, prize money)
  - [ ] Create match information section with formatted match data
  - [ ] Implement responsive design with mobile-optimized layout
  - [ ] Add tournament statistics summary (total matches, completion status)
- [ ] Match Display Components (AC: 2, 3, 5)
  - [ ] Create MatchCard.tsx component for individual match display using shadcn/ui Card
  - [ ] Implement match status indicators using shadcn/ui Badge components
  - [ ] Add team and player information formatting
  - [ ] Create match score display with set-by-set breakdown
  - [ ] Add match time and court information display
  - [ ] Implement expandable match details for additional information
- [ ] Navigation and Routing (AC: 4, 5)
  - [ ] Create TournamentDetailPage.tsx page component
  - [ ] Add React Router route configuration for /tournaments/:id
  - [ ] Implement navigation breadcrumbs using shadcn/ui Breadcrumb component
  - [ ] Add back to tournament list navigation functionality
  - [ ] Configure URL parameter handling for tournament ID
  - [ ] Add proper page title and meta information
- [ ] Data Fetching and State Management (AC: 1, 2, 6)
  - [ ] Create useTournamentDetail.ts hook using React Query
  - [ ] Implement tournament detail API service calls
  - [ ] Add loading states with shadcn/ui Skeleton components
  - [ ] Configure error handling with shadcn/ui Alert components
  - [ ] Add data prefetching strategies for performance
  - [ ] Implement cache invalidation for real-time updates
- [ ] Error Handling and Edge Cases (AC: 6)
  - [ ] Implement tournament not found error page using shadcn/ui Alert
  - [ ] Add graceful degradation for missing match data
  - [ ] Create retry functionality for failed API requests
  - [ ] Add empty state handling for tournaments with no matches
  - [ ] Implement proper error boundaries for component failures
  - [ ] Add user-friendly error messages for various failure scenarios

## Dev Notes

### Specific shadcn/ui Component Requirements

**Core Component Imports:**
```typescript
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Skeleton } from '@/components/ui/skeleton';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Breadcrumb, BreadcrumbItem, BreadcrumbLink, BreadcrumbList, BreadcrumbPage, BreadcrumbSeparator } from '@/components/ui/breadcrumb';
import { Separator } from '@/components/ui/separator';
```

**Badge Variants for Status Indicators:**
- Tournament Status: `variant="default"` (Upcoming), `variant="secondary"` (Completed), `variant="destructive"` (Cancelled), custom orange variant for Live
- Match Status: `variant="default"` (Scheduled), `variant="secondary"` (Completed), `variant="destructive"` (Cancelled/Postponed), custom green variant for Live
- Tournament Level: `variant="outline"` for level indicators (World Tour, Continental, etc.)

**Responsive Layout Implementation:**
- Desktop: Use Table component for match listings with full information
- Mobile: Use stacked Card components with condensed layout
- Breakpoints: `className="hidden md:block"` for table view, `className="md:hidden"` for mobile cards

**Loading State Components:**
```typescript
// Tournament header skeleton
<Card className="mb-6">
  <CardHeader>
    <Skeleton className="h-8 w-3/4 mb-2" />
    <Skeleton className="h-4 w-1/2 mb-2" />
    <Skeleton className="h-4 w-1/3" />
  </CardHeader>
</Card>

// Match table/list skeleton
<div className="space-y-2">
  {Array.from({ length: 5 }).map((_, i) => (
    <Skeleton key={i} className="h-16 w-full" />
  ))}
</div>
```

**Error Handling Implementation:**
```typescript
<Alert variant="destructive">
  <AlertDescription>
    Failed to load tournament details. Please try again.
  </AlertDescription>
</Alert>
```

**Icon Integration (lucide-react):**
- Import: `Calendar`, `MapPin`, `Trophy`, `Clock`, `Users`, `ChevronLeft`
- Usage: 4x4 size (`h-4 w-4`) for inline icons, 12x12 size (`h-12 w-12`) for empty states

**Component Layout Structure:**
```typescript
<div className="space-y-6">
  <Breadcrumb /> {/* Navigation */}
  <Card> {/* Tournament Header */}
    <CardHeader>
      <CardTitle /> {/* Tournament name + status badge */}
      <div className="flex flex-wrap gap-2"> {/* Tournament metadata badges */}
    </CardHeader>
  </Card>
  <Separator />
  <Card> {/* Match listings */}
    <CardHeader>
      <CardTitle>Matches</CardTitle>
    </CardHeader>
    <CardContent>
      <Table className="hidden md:block" /> {/* Desktop table */}
      <div className="md:hidden space-y-2"> {/* Mobile cards */}
    </CardContent>
  </Card>
</div>
```

### Previous Story Insights
From Story 2.1 (Done):
- React 18.2+ with TypeScript and Vite build system ready
- shadcn/ui component library configured with Tailwind CSS
- React Router v6 installed for client-side routing
- React Query (TanStack Query) ready for API state management
- Tournament data model and API endpoints established
- Tournament controller with comprehensive error handling and validation patterns
- VIS service integration with circuit breaker and retry logic
- Tournament utility functions available in tournament.utils.ts

From Story 2.2 (In Progress):
- Advanced filtering and state management patterns established
- URL parameter sync patterns available for reuse
- Performance optimization strategies implemented
- shadcn/ui component patterns established for complex UI elements

### Data Models
[Source: fullstack-architecture/data-architecture.md#data-models]
**Tournament Data Model (Available for Detail View):**
```typescript
interface Tournament {
  id: string;
  name: string;
  dates: {
    start: Date;
    end: Date;
  };
  location: {
    city: string;
    country: string;
    venue?: string;
    coordinates?: {
      lat: number;
      lng: number;
    };
  };
  level: 'World Tour' | 'Continental' | 'National' | 'Regional';
  status: 'Upcoming' | 'Live' | 'Completed' | 'Cancelled';
  matchCount: number;
  prizeMoney?: number;
  surface: 'Sand' | 'Indoor';
  gender: 'Men' | 'Women' | 'Mixed';
}
```

**Match Data Model (for Match Listings):**
```typescript
interface Match {
  id: string;
  tournamentId: string;
  teams: {
    team1: {
      player1: string;
      player2: string;
      country: string;
    };
    team2: {
      player1: string;
      player2: string;
      country: string;
    };
  };
  score: {
    set1?: { team1: number; team2: number; };
    set2?: { team1: number; team2: number; };
    set3?: { team1: number; team2: number; };
  };
  status: 'Scheduled' | 'Live' | 'Completed' | 'Postponed';
  scheduledTime: Date;
  actualStartTime?: Date;
  duration?: number;
  round: string;
  court: string;
  winner?: 'team1' | 'team2';
}
```

**Tournament Detail Response Model:**
```typescript
interface TournamentDetailResponse {
  tournament: Tournament;
  matches: Match[];
  statistics: {
    totalMatches: number;
    completedMatches: number;
    upcomingMatches: number;
    liveMatches: number;
  };
}
```

### API Specifications
[Source: fullstack-architecture/backend-architecture.md#api-endpoints-specification]
**Tournament Detail Endpoint:**
```typescript
GET /api/tournaments/:id
- Parameters: Tournament ID (string)
- Response: Detailed tournament information with matches
- Cache: 3 minutes
- Error responses: 400 (invalid ID), 404 (not found), 500 (server error)
```

**Tournament Matches Endpoint:**
```typescript
GET /api/tournaments/:id/matches
- Parameters: Tournament ID
- Response: All matches for specific tournament
- Cache: 2 minutes
- Query parameters: round, status (optional filtering)
```

### Component Specifications
[Source: fullstack-architecture/frontend-architecture.md#key-components-specification]

**Required shadcn/ui Components for Tournament Detail:**
- **Card** - Tournament information and match display containers
- **Badge** - Tournament status, match status, and competition level indicators
- **Button** - Navigation actions and interactive elements
- **Breadcrumb** - Navigation breadcrumbs for tournament hierarchy
- **Alert** - Error message display and important information
- **Skeleton** - Loading state animations for detail content
- **Separator** - Visual section separation in tournament details
- **Table** - Structured match data display (optional alternative to cards)

**TournamentDetail Component Architecture:**
```
src/components/tournament/
├── TournamentDetail.tsx        # Main detail display component
├── TournamentHeader.tsx        # Tournament title and key information
├── TournamentStats.tsx         # Tournament statistics and metadata
├── MatchCard.tsx               # Individual match display (extend existing)
└── MatchList.tsx               # Match listings container
```

**TournamentDetailPage Architecture:**
```
src/pages/
└── TournamentDetailPage.tsx    # Page wrapper with routing and error boundaries
```

### File Locations to Create/Modify
[Source: fullstack-architecture/frontend-architecture.md#component-architecture]
**Frontend Files to Create:**
- `src/components/tournament/TournamentDetail.tsx` - Main tournament detail component
- `src/components/tournament/TournamentHeader.tsx` - Tournament title and metadata
- `src/components/tournament/TournamentStats.tsx` - Tournament statistics display
- `src/components/tournament/MatchList.tsx` - Match listings container
- `src/pages/TournamentDetailPage.tsx` - Tournament detail page wrapper
- `src/hooks/useTournamentDetail.ts` - Tournament detail data hook
- `src/utils/match.utils.ts` - Match formatting and utility functions

**Frontend Files to Modify:**
- `src/components/tournament/MatchCard.tsx` - Extend for detail view display
- `src/services/tournament.service.ts` - Add tournament detail API calls
- `src/types/tournament.types.ts` - Add tournament detail interfaces
- `src/types/match.types.ts` - Add match-related type definitions
- `src/App.tsx` - Add tournament detail route configuration

**Backend Files to Modify:**
- `src/controllers/tournament.controller.ts` - Add getTournamentById endpoint
- `src/services/tournament.service.ts` - Add tournament detail business logic
- `src/services/vis.service.ts` - Extend VIS integration for tournament details and matches
- `src/routes/tournament.routes.ts` - Add tournament detail route definitions

### Navigation and Routing
[Source: fullstack-architecture/frontend-architecture.md#component-architecture]
**Route Configuration:**
- Path: `/tournaments/:id`
- Component: `TournamentDetailPage`
- Parameters: `id` (tournament identifier)
- Navigation: Accessible from tournament list via tournament name/row click

**Breadcrumb Navigation:**
- Structure: Home > Tournaments > [Tournament Name]
- Implementation: shadcn/ui Breadcrumb component
- Back functionality: Return to tournaments list with preserved filter state

### Performance Optimization
[Source: fullstack-architecture/frontend-architecture.md#performance-optimization]
**Tournament Detail Performance Patterns:**
- React Query caching for tournament details (3-minute stale time)
- Prefetching tournament details on hover from tournament list
- Lazy loading of match data if tournament has many matches
- Image optimization for tournament venue photos (if available)
- Component memoization for match list rendering

**Caching Strategy:**
- Tournament details cached for 3 minutes on backend
- Match data cached for 2 minutes on backend
- React Query cache with automatic background refetch
- Cache invalidation on tournament status changes

### State Management
[Source: fullstack-architecture/frontend-architecture.md#state-management]
**Tournament Detail State Architecture:**
- React Query for server state (tournament and match data)
- Local component state for UI interactions (expanded sections, etc.)
- URL parameters for tournament ID routing
- Error state management with proper fallbacks

### Error Handling & Resilience
[Source: fullstack-architecture/error-handling-architecture.md]
- Tournament not found (404) handling with user-friendly message
- VIS API failure graceful degradation with cached data
- Match data loading failures with partial content display
- Network error retry functionality with exponential backoff
- Component error boundaries to prevent page crashes
- Loading state management for progressive content loading

### Testing
[Source: fullstack-architecture/testing-architecture.md#testing-strategy]
**Required Testing Implementation:**
- Unit tests for TournamentDetail.tsx component (Jest + React Testing Library)
- Unit tests for useTournamentDetail.ts hook (React Testing Library)
- Unit tests for match formatting utilities (Jest)
- Integration tests for tournament detail API endpoints
- Accessibility tests for detail page navigation and content
- Performance tests for large tournament data rendering
- Error boundary testing for component failure scenarios

**Testing Structure:**
```
tests/unit/
├── components/tournament/
│   ├── TournamentDetail.test.tsx
│   ├── TournamentHeader.test.tsx
│   ├── TournamentStats.test.tsx
│   └── MatchList.test.tsx
├── hooks/
│   └── useTournamentDetail.test.ts
├── pages/
│   └── TournamentDetailPage.test.tsx
└── utils/
    └── match.utils.test.ts
tests/integration/
├── tournament-detail/
│   ├── tournament-detail-api.test.ts
│   └── tournament-navigation.test.ts
└── accessibility/
    └── tournament-detail-accessibility.test.ts
```

**Performance & Accessibility Standards:**
- Tournament detail page load time target: <2.5s (LCP)
- Match list rendering performance for 100+ matches
- WCAG AA compliance for all content areas
- Keyboard navigation support for all interactive elements
- Screen reader announcements for dynamic content updates
- Focus management for page navigation and error states

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-27 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be added here after implementation*