# Story 4.2: match-details-dialog-individual-match-views

## Status
Approved

## Story
**As a** referee,
**I want** to view detailed match information including set scores and match duration,
**so that** I can access comprehensive match data for officiating and analysis.

## Acceptance Criteria
1. Match cards have clickable actions to open detailed match information
2. Match detail dialog displays comprehensive match data using Dialog components
3. Set scores are clearly displayed for completed matches (Set 1, Set 2, Set 3)
4. Match duration and timing information is properly formatted
5. Team information displays with proper names and seeding information
6. Court assignments and scheduling details are clearly visible
7. Dialog maintains responsive design and accessibility standards

## Tasks / Subtasks
- [ ] Add clickable actions to match cards (AC: 1)
  - [ ] Update MatchCard component with click handler and hover states
  - [ ] Add visual indicators for clickable match cards (cursor pointer, hover effects)
  - [ ] Implement proper ARIA labels for match card buttons
  - [ ] Ensure 48px touch targets for mobile venue usage
- [ ] Create match detail dialog component (AC: 2)
  - [ ] Create MatchDetailDialog component using shadcn Dialog
  - [ ] Implement responsive dialog layout for mobile and desktop
  - [ ] Add proper dialog accessibility with focus management
  - [ ] Include close button and ESC key handling
- [ ] Design set score display components (AC: 3)
  - [ ] Create SetScoreDisplay component for completed matches
  - [ ] Display set scores in clear format (21-19, 21-17, 15-13)
  - [ ] Add visual indicators for set winners
  - [ ] Handle different match formats (2 sets, 3 sets, golden set)
- [ ] Implement match timing and duration display (AC: 4)
  - [ ] Create MatchTiming component with start time, duration, and end time
  - [ ] Format match duration properly (1h 23m format)
  - [ ] Display match scheduling information (scheduled time vs actual time)
  - [ ] Add timezone considerations for match timing
- [ ] Add comprehensive team information display (AC: 5)
  - [ ] Create TeamInfo component with team names and player details
  - [ ] Display seeding information and tournament ranking
  - [ ] Add confederation and federation information if available
  - [ ] Include team statistics and tournament performance data
- [ ] Display court and venue assignment details (AC: 6)
  - [ ] Show court number, court surface type, and venue information
  - [ ] Add match round and tournament phase information
  - [ ] Display match importance (qualification, main draw, finals, etc.)
  - [ ] Include weather conditions if relevant for outdoor courts
- [ ] Ensure dialog responsive design and accessibility (AC: 7)
  - [ ] Test dialog display on mobile, tablet, and desktop devices
  - [ ] Implement proper keyboard navigation and focus management
  - [ ] Add screen reader support with comprehensive ARIA labels
  - [ ] Maintain 48px touch targets for all interactive elements within dialog

## Dev Notes

### Epic 4 Integration Context
[From Story 4.1: Match Schedule Display Components Foundation - Dependencies]
- Builds upon MatchCard component created in Story 4.1
- Extends schedule display with interactive match detail functionality
- Maintains consistent design patterns with existing Epic 3 tournament detail components
- Follows APIArchitecture.md specifications for BeachMatchDetail interface

### Story 4.1 Integration Points
[Source: Story 4.1 MatchCard component implementation]

**Existing MatchCard Component (from Story 4.1):**
```typescript
// Story 4.1 creates this - Story 4.2 extends it
<Card className="p-4 hover:shadow-md transition-shadow">
  <div className="flex items-center justify-between">
    {/* Basic match information */}
  </div>
</Card>
```

**Story 4.2 Enhancement:**
```typescript
// Enhanced MatchCard with clickable functionality
<Card className="p-4 hover:shadow-md transition-shadow cursor-pointer" 
      onClick={() => setSelectedMatch(match)}
      role="button"
      tabIndex={0}
      onKeyDown={handleKeyDown}
      aria-label={`View details for match ${match.teamAName} vs ${match.teamBName}`}>
  <div className="flex items-center justify-between">
    {/* Existing match information from Story 4.1 */}
    <Button variant="ghost" size="sm" className="ml-2">
      <MoreHorizontal className="h-4 w-4" />
    </Button>
  </div>
</Card>
```

### Enhanced Mock Data Structure for Story 4.2
[Source: APIArchitecture.md BeachMatchDetail interface specifications]

**Extended Mock Match Detail Data:**
```typescript
interface MockBeachMatchDetail extends MockBeachMatch {
  // Additional fields for Story 4.2 (extends Story 4.1 structure)
  matchPointsA: number          // Sets won by Team A
  matchPointsB: number          // Sets won by Team B
  pointsTeamASet1: number       // Set 1 score for Team A
  pointsTeamBSet1: number       // Set 1 score for Team B
  pointsTeamASet2: number       // Set 2 score for Team A
  pointsTeamBSet2: number       // Set 2 score for Team B
  pointsTeamASet3?: number      // Set 3 score for Team A (optional)
  pointsTeamBSet3?: number      // Set 3 score for Team B (optional)
  durationSet1: string          // "32:15" (mm:ss format)
  durationSet2: string          // "28:43"
  durationSet3?: string         // Optional third set
  totalDuration: string         // "1:23:45" (h:mm:ss format)
  actualStartTime: string       // "09:15" (actual vs scheduled time)
  courtSurface: 'sand' | 'indoor' | 'grass'
  roundName: string             // "Pool A", "Quarterfinals", etc.
  phase: 'qualification' | 'mainDraw' | 'finals'
}

// Enhanced mock data for Story 4.2 development
const mockMatchDetailData: MockBeachMatchDetail = {
  // Base fields from Story 4.1
  noInTournament: "M001",
  localDate: "2025-08-15",
  localTime: "09:00",
  teamAName: "Smith/Jones",
  teamBName: "Wilson/Davis",
  court: "Court 1",
  status: "completed",
  
  // Enhanced fields for Story 4.2
  matchPointsA: 2,
  matchPointsB: 1,
  pointsTeamASet1: 21,
  pointsTeamBSet1: 19,
  pointsTeamASet2: 18,
  pointsTeamBSet2: 21,
  pointsTeamASet3: 15,
  pointsTeamBSet3: 12,
  durationSet1: "32:15",
  durationSet2: "28:43",
  durationSet3: "18:22",
  totalDuration: "1:23:45",
  actualStartTime: "09:15",
  courtSurface: "sand",
  roundName: "Pool A",
  phase: "qualification"
}
```

### Component Architecture for Story 4.2

**New Match Detail Components:**
```typescript
// Story 4.2 component hierarchy
MatchDetailDialog.tsx
├── MatchDetailHeader.tsx       # Match title and basic info
├── TeamInfo.tsx               # Team names, seeding, confederation
├── SetScoreDisplay.tsx        # Set-by-set score breakdown
├── MatchTiming.tsx            # Duration, start/end times
├── CourtVenueInfo.tsx         # Court assignment and conditions
└── MatchStatistics.tsx        # Additional match statistics
```

**Dialog Component Pattern:**
```typescript
// Main dialog structure using shadcn Dialog
<Dialog open={isOpen} onOpenChange={setIsOpen}>
  <DialogContent className="max-w-2xl max-h-[80vh] overflow-y-auto">
    <DialogHeader>
      <DialogTitle>
        Match Details - {match.teamAName} vs {match.teamBName}
      </DialogTitle>
      <DialogDescription>
        {match.roundName} • {match.courtName} • {formatMatchDate(match.localDate)}
      </DialogDescription>
    </DialogHeader>
    
    <div className="space-y-6">
      <TeamInfo match={match} />
      <SetScoreDisplay match={match} />
      <MatchTiming match={match} />
      <CourtVenueInfo match={match} />
    </div>
    
    <DialogFooter>
      <Button variant="outline" onClick={() => setIsOpen(false)}>
        Close
      </Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

**SetScoreDisplay Component Pattern:**
```typescript
// Set score display with visual winners
<div className="grid grid-cols-1 md:grid-cols-3 gap-4">
  {[1, 2, 3].map((setNumber) => {
    if (!match[`pointsTeamASet${setNumber}`]) return null
    
    const scoreA = match[`pointsTeamASet${setNumber}`]
    const scoreB = match[`pointsTeamBSet${setNumber}`]
    const duration = match[`durationSet${setNumber}`]
    const setWinner = scoreA > scoreB ? 'A' : 'B'
    
    return (
      <Card key={setNumber} className="p-4">
        <div className="text-center mb-2">
          <h4 className="font-semibold">Set {setNumber}</h4>
          <p className="text-sm text-gray-600">{duration}</p>
        </div>
        <div className="flex items-center justify-between">
          <div className={`text-lg font-bold ${setWinner === 'A' ? 'text-green-600' : ''}`}>
            {scoreA}
          </div>
          <div className="text-sm text-gray-500">-</div>
          <div className={`text-lg font-bold ${setWinner === 'B' ? 'text-green-600' : ''}`}>
            {scoreB}
          </div>
        </div>
      </Card>
    )
  })}
</div>
```

**TeamInfo Component Pattern:**
```typescript
// Team information with seeding and details
<div className="grid grid-cols-1 md:grid-cols-2 gap-6">
  <Card className="p-4">
    <div className="text-center">
      <h3 className="text-lg font-semibold mb-2">{match.teamAName}</h3>
      <div className="space-y-1 text-sm text-gray-600">
        <p>Seed: #{match.teamASeed || 'Unseeded'}</p>
        <p>Confederation: {match.teamAConfederation || 'Unknown'}</p>
        <p>Ranking: #{match.teamARanking || 'Unranked'}</p>
      </div>
    </div>
  </Card>
  
  <Card className="p-4">
    <div className="text-center">
      <h3 className="text-lg font-semibold mb-2">{match.teamBName}</h3>
      <div className="space-y-1 text-sm text-gray-600">
        <p>Seed: #{match.teamBSeed || 'Unseeded'}</p>
        <p>Confederation: {match.teamBConfederation || 'Unknown'}</p>
        <p>Ranking: #{match.teamBRanking || 'Unranked'}</p>
      </div>
    </div>
  </Card>
</div>
```

### File Locations and Component Structure
[Source: Established Epic 3 patterns and Story 4.1 foundation]

**New Files to Create:**
- `components/tournament/schedule/MatchDetailDialog.tsx` - Main dialog component
- `components/tournament/schedule/MatchDetailHeader.tsx` - Dialog header with match info
- `components/tournament/schedule/TeamInfo.tsx` - Team information display
- `components/tournament/schedule/SetScoreDisplay.tsx` - Set score breakdown
- `components/tournament/schedule/MatchTiming.tsx` - Match duration and timing
- `components/tournament/schedule/CourtVenueInfo.tsx` - Court and venue details
- `components/tournament/schedule/MatchStatistics.tsx` - Additional match stats

**Files to Modify:**
- `components/tournament/schedule/MatchCard.tsx` - Add click handler and dialog trigger
- `components/tournament/schedule/TournamentSchedule.tsx` - Integrate dialog state management

**Enhanced Directory Structure:**
```
components/tournament/schedule/
├── TournamentSchedule.tsx         # MODIFY: Add dialog state management
├── ScheduleByDay.tsx              # From Story 4.1
├── MatchCard.tsx                  # MODIFY: Add clickable functionality
├── MatchStatus.tsx                # From Story 4.1
├── MatchDetailDialog.tsx          # NEW: Main dialog component
├── MatchDetailHeader.tsx          # NEW: Dialog header
├── TeamInfo.tsx                   # NEW: Team information
├── SetScoreDisplay.tsx            # NEW: Set score breakdown
├── MatchTiming.tsx                # NEW: Match timing display
├── CourtVenueInfo.tsx             # NEW: Court and venue info
├── MatchStatistics.tsx            # NEW: Additional statistics
├── TournamentScheduleSkeleton.tsx # From Story 4.1
└── EmptySchedule.tsx              # From Story 4.1
```

### Mobile-First Responsive Design for Dialogs

**Dialog Responsive Behavior:**
- **Mobile (< 768px)**: Full-screen dialog with scroll, single-column layout
- **Tablet (768px - 1024px)**: Modal dialog with responsive grid layout
- **Desktop (> 1024px)**: Fixed-width modal with multi-column information display

**Touch Interaction Requirements:**
- All dialog buttons maintain 48px minimum touch targets
- Close button positioned for easy thumb access on mobile
- Swipe gestures for dialog dismissal on mobile devices
- Proper focus management when dialog opens/closes

**Accessibility Standards:**
- Dialog traps keyboard focus within modal
- ESC key closes dialog consistently
- Screen reader announces dialog content properly
- Focus returns to triggering match card when dialog closes

### Performance Considerations for Dialog Components

**Lazy Loading Strategy:**
- MatchDetailDialog components loaded only when first match is clicked
- Dialog content rendered only when opened (not pre-rendered)
- Heavy components (statistics, charts) loaded on demand

**State Management:**
- Single dialog instance shared across all match cards
- Match data passed as props to avoid multiple dialog instances
- Smooth open/close animations without performance impact

**Memory Management:**
- Dialog content cleanup when closed to prevent memory leaks
- Event listeners properly removed on component unmount
- Image assets (if any) optimized for mobile networks

## Testing

### Test File Location
- Create new test: `__tests__/components/tournament/schedule/MatchDetailDialog.test.tsx`
- Create new test: `__tests__/components/tournament/schedule/TeamInfo.test.tsx`
- Create new test: `__tests__/components/tournament/schedule/SetScoreDisplay.test.tsx`
- Create new test: `__tests__/components/tournament/schedule/MatchTiming.test.tsx`
- Update existing test: `__tests__/components/tournament/schedule/MatchCard.test.tsx`

### Test Standards
- Use Jest + React Testing Library with established project patterns
- Test dialog accessibility with focus management and keyboard navigation
- Mock user interactions (click, keyboard, touch) for comprehensive testing
- Test responsive design across different viewport sizes

### Testing Requirements for This Story
- Verify match cards are clickable and open dialog (AC: 1)
- Test match detail dialog displays comprehensive match data (AC: 2)
- Validate set scores display correctly for 2-set and 3-set matches (AC: 3)
- Test match duration and timing formatting (AC: 4)
- Ensure team information displays with names and seeding (AC: 5)
- Verify court assignment and venue details are visible (AC: 6)
- Test dialog responsive design and accessibility (AC: 7)
- Validate keyboard navigation and ESC key dialog closing
- Test screen reader accessibility with proper ARIA labels
- Ensure 48px touch targets throughout dialog interface
- Test dialog focus management (open/close behavior)
- Validate smooth dialog animations and transitions

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-01 | 1.0 | Initial story creation for match details dialog and individual match views based on Epic 4 specifications and Story 4.1 foundation | Sarah (Product Owner) |